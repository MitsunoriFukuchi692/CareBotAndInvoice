<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>介護支援ボット</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    /* 既存CSSがあればそのままでOK。下は軽い追記 */
    .card { border:1px solid #e5e5e5; border-radius:12px; padding:12px; margin:12px 0; }
    .row { display:flex; gap:8px; }
    .row input { flex:1; padding:8px 10px; border:1px solid #ccc; border-radius:6px; }
    .mono { font-family:ui-monospace,Consolas,Menlo,monospace; white-space:pre-wrap; }
    button { background:#0d6efd; color:#fff; border:none; border-radius:999px; padding:8px 14px; cursor:pointer; }
    button.secondary{ background:#6c757d; }
  </style>
</head>
<body>
  <header>
    <h1>介護支援ボット</h1>
    <nav>
      <a href="/">ホーム</a> |
      <a href="/camera-test/">カメラ実験ページ</a> |
      <a href="/daily_report">本日の見守りレポート</a>
    </nav>
  </header>

  <!-- ここに既存のチャットUI（テンプレ、ログ、入力欄など）が入っている想定 -->
  <main id="app-root">
    <!-- 既存のチャットUIをそのまま残してください -->
  </main>

  <!-- ★ 用語説明（ここが新規追加） -->
  <section class="card" aria-label="用語説明">
    <h2>用語のかんたん説明（30文字以内）</h2>
    <div class="row">
      <input id="explain-input" placeholder="例：排便" />
      <button id="explain-btn">説明</button>
    </div>
    <div id="explain-result" class="mono"></div>
  </section>

  <script src="/static/chatbot.v3.js"></script>
  <script>
    // 既存のチャット初期化は chatbot.v3.js 側に任せる

    // === 用語説明だけ、このページ内で完結 ===
    async function explainWord(word){
      try{
        const res = await fetch('/ja/explain?v=' + Date.now(), {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ word })
        });
        const text = await res.text();
        let data; try{ data = JSON.parse(text); } catch { data = { definition: text || '説明に失敗' }; }
        return data.definition || '説明に失敗';
      }catch(e){
        console.error(e);
        return 'ネットワークエラー';
      }
    }
    const $ = s => document.querySelector(s);
    $('#explain-btn').addEventListener('click', async ()=>{
      const w = $('#explain-input').value.trim();
      if(!w){ $('#explain-result').textContent='入力してください'; return; }
      $('#explain-result').textContent = '…生成中';
      const ans = await explainWord(w);
      $('#explain-result').textContent = ans;
    });
  </script>
</body>
</html>
