<script>
document.addEventListener("DOMContentLoaded", () => {
  const video = document.getElementById("camera");
  const captureBtn = document.getElementById("captureBtn");
  const canvas = document.getElementById("canvas");
  const photo = document.getElementById("photo");

  // カメラ起動
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => {
      alert("カメラにアクセスできません: " + err);
    });

  // 写真撮影
  captureBtn.addEventListener("click", () => {
    console.log("📸 ボタン押されました");

    const context = canvas.getContext("2d");
    const width = video.videoWidth || 640;
    const height = video.videoHeight || 480;

    canvas.width = width;
    canvas.height = height;

    context.drawImage(video, 0, 0, width, height);

    const dataUrl = canvas.toDataURL("image/png");
    photo.src = dataUrl;

    console.log("✅ 写真を生成しました:", dataUrl.substring(0,50));
  });
});
</script>
